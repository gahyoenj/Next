# App Router

- page router와 달라진 점

  - 페이지 라우팅 설정 방식 변경
  - 레이아웃 설정 방식 변경
  - 데이터 페칭 방식 변경
  - React 18 신규 기능 추가

- page router에서 크게 변경되지 않은 사항

  - 네이게이팅
  - 프리페칭
  - 사전 렌더링

- page router를 사용하지 않기 때문에 page 폴더가 따로 없음
- app router에서는 page.tsx 라는 page 이름을 가진 파일이 페이지 역할을 함
- layout.tsx는 이 페이지의 레이아웃을 설정하는 파일이 됨

- app router 에서는 app 폴더를 기반으로 페이지 만들어야함
  - app 폴더 아래 폴더 만들고 폴더 아래에 page.tsx 만들면 됨
  - 동적경로 대응하게 되는 페이지는 폴더 아래 [id] 폴더 만들고 그 아래에 page.tsx 만들면 됨

=> app router에서는 page 이름 갖는 폴더만 페이지 되기 때문

- 폴더 아래 layout.tsx 를 통해 레이아웃 적용하게 되면 그 폴더 아래에 있는 모든 폴더(즉 /폴더이름/... 이런 모든 경로)애도 레이아웃 적용됨!
- 하위 폴더들의 layout.tsx는 상위 폴더의 layout.tsx와 중첩되어 상위 폴더의 레이아웃 먼저 적용되고 그다음 하위폴더 레이아웃 적용
- 레이아웃이 적용된 후 페이지 컴포넌트 적용

<br>

### Route Group

- 경로 상에는 아무런 영향을 미치지 않는 폴더
- () 이렇게 소괄호로 묶으면 됨
- 라우트 그룹을 이용하면 각기 다른 경로를 갖는 것들을 하나의 폴더로 묶을 수 있음
- 레이아웃은 동일하게 적용 가능함

## React Server Component

- 서버측에서만 실행되는 컴포넌트
- 브라우저에서는 실행되지 않음
- 상호작용이 없는 컴포넌트들은 hydration을 할 필요 없음
- 이런 컴포넌트들은 서버측에서 한번만 실행되고 더이상 실행될 필요없음(hydration 필요없음)
- 상호 작용 없는 컴포넌트들을 서버 컴포넌트로 분류 하고 상호작용 있는 컴포넌트는 클라이언트 컴포넌트로 분류해서 js bundle에 클라이언트 컴포넌트만 포함
- 서버측에서 사전 렌더링을 진행할때 딱 한번만 실행됨
- 페이지 대부분을 서버 컴포넌트로 구성할 것을 권장하며 클라이언트 컴포넌트는 꼭 필요한 경우에만 사용할것
- 클라이언트 갯수가 줄어들면 js bundle 크기가 줄어들기 때문
- 서버 컴포넌트에서 리액트 훅 사용하면 오류 뜸 => 리액트 훅은 브라우저에서 작동하기 때문

<br>

- 클라이언트 컴포넌트로 만들고 싶으면 파일 상단에 "use client"; 지시자를 명시하면 됨
- 입력이나 클릭 같은 상호작용이 있는 컴포넌트들만 클라이언트 컴포넌트로 만들면 됨

<br>

#### 서버컴포넌트 주의사항

1. 서버컴포넌트에는 브라우저에서 실행될 코드가 포함되면 안된다

- useEffecth 같은 리액트 훅이나 이벤트 핸들러 포함되면 안됨

2. 클라이언트 컴포넌트는 클라이언트에서만 실행되지 않는다

- 사전 렌더링을 위해 서버에서 1번 실행
- 하이드레이션을 위해 브라우저에서만 1번 실행
  = 서버와 클라이언트에서 모두 실행됨

3. 클라이언트 컴포넌트에서 서버 컴포넌트를 import 할 수 없다

   - 클라이언트 컴포넌트 코드는 서버와 브라우저에서 모두 실행되기 때문
   - 서버 컴포넌트는 서버에서만 실행되므로 아예 브라우저에 전달이 안됨
   - 이런 경우 next.js는 자동으로 서버 컴포넌트를 클라이언트 컴포넌트로 변경함
   - 직접 import하지말고 children으로 넘겨주는 형식으로 구성하면 children으로 전달된 서버 컴포넌트는 클라이언트 컴포넌트로 변경하지 않음

4. 서버컴포넌트에서 클라이언트 컴포넌트에게 직렬화되지 않는 props는 전달 불가하다

- 직렬화 = 객체,배열,클래스 등의 복잡한 구조의 데이터를 네트워크 상으로 전송하기 위해 아주 단순한 형태(문자열,byte)로 변화하는 것
- 자바스크립트 함수는 직렬화 불가능
- 함수형태의 값을 props는 직렬화 불가능이라 runtime error 발생

### Navigation

- 페이지 이동은 CSR 방식으로 처리!
- 프리페칭 = 이동할 페이지의 데이터를 미리 불러오는 기능
- 앱라우터는 서버컴포넌트의 결과물인 RSC payload도 JS Bundle과 함께 전달함
- 클라이언트 컴포넌트 포함하는 JS Bundle 파일만 브라우저에 전달하면 서버 컴포넌트가 누락되기 때문
-
